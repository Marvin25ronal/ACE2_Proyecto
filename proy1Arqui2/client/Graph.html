<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
	<meta http-equiv="x-ua-compatible" content="ie=edge">
	<title>Material Design Bootstrap</title>
	<!-- Font Awesome -->
	<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.2/css/all.css">
	<!-- Bootstrap core CSS -->
	<link href="css/bootstrap.min.css" rel="stylesheet">
	<!-- Material Design Bootstrap -->
	<link href="css/mdb.min.css" rel="stylesheet">
	<!-- Your custom styles (optional) -->
	<link href="css/style.css" rel="stylesheet">

</head>

<body>

	<h2 style="text-align: center;">UNIVERSIDAD DE SAN CARLOS DE GUATEMALA</h2>
	<h3 style="text-align: center;">Arqui2 Grupo 15</h3>
	<hr />



	<table style="width:100%">
		<tr>
			<td>
				<a href="index.html">
					<h5 style="text-align: center;">Estado del basurero</h5>
				</a>
			</td>
			<td>
				<a href="default.html">
					<h5 style="text-align: center;">Logs del basurero</h5>
				</a>
			</td>
		</tr>
	</table>
	<h5 style="text-align: center;">Graficas</h5>

	<hr />

	<div class="container">
		<div class="row">
			<div class="col-md-3">

			</div>
			<div class="col-md-3" id="fFecha">

			</div>
			<div class="col-md-3" id="fUbic">

			</div>
			<div class="col-md-3" id="fHora">


			</div>
		</div>
		<div class="row">
			<div class="col-md-3">
				<button onclick="insertGraph(0);">Sin filtro</button>
			</div>
			<div class="col-md-3">
				<button onclick="insertGraph(1);">Filtrar fecha</button>
			</div>
			<div class="col-md-3">
				<button onclick="insertGraph(2);">Filtrar ubicacion</button>
			</div>
			<div class="col-md-3">

				<button onclick="insertGraph(3);">Filtrar hora</button>
			</div>
		</div>
	</div>

	<hr />
	<h3 id="filtro" style="text-align: center;">Sin filtros</h3>
	<hr />


	<!-- Start your project here-->
	<div class="container-fluid">
		<div class="row">
			<div class="col-md-6">
				<h5 style="text-align: center;">Grafico de peso en funcion de fecha y hora</h5>
				<canvas id="lcPeso"></canvas>
			</div>
			<div class="col-md-6">
				<h5 style="text-align: center;">Grafico de Temperatura en funcion de fecha y hora</h5>
				<canvas id="lcTemp"></canvas>
			</div>
			<div class="col-md-6">
				<h5 style="text-align: center;">Grafico de Calidad del aire en funcion de fecha y hora</h5>
				<canvas id="lcCa"></canvas>
			</div>
			<div class="col-md-6">
				<h5 style="text-align: center;">Grafico de porcentaje de liquido en funcion de fecha y hora</h5>
				<canvas id="lcHl"></canvas>
			</div>

			<div class="col-md-12">
				<h5 style="text-align: center;">Grafico las variables en funcion de fecha y hora</h5>
				<canvas id="lcTodo"></canvas>
			</div>


			<div class="col-md-12">
				<h5 id="lqseat" style="text-align: center;">Grafico las variables que seleccione el usuario</h5>

				<div class="row">
					<div class="col-md-6">

						<div class="form-group">
							<label for="exampleFormControlSelect1">Variable dependiente(y)</label>
							<select class="form-control" id="gs1">
								<option value="1">Peso</option>
								<option value="2">Temperatura</option>
								<option value="3">Calidad del aire</option>
								<option value="4">Porcentaje de liquido</option>
								<option value="5">Fecha</option>
								<option value="6">Hora</option>
								<option value="7">Ubicacion</option>
								<option value="8">Fecha + hora</option>
							</select>
						</div>
					</div>
					<div class="col-md-6">

						<div class="form-group">
							<label for="exampleFormControlSelect1">Variable independiente(x)</label>
							<select class="form-control" id="gs2">
								<option value="1">Peso</option>
								<option value="2">Temperatura</option>
								<option value="3">Calidad del aire</option>
								<option value="4">Porcentaje de liquido</option>
								<option value="5">Fecha</option>
								<option value="6">Hora</option>
								<option value="7">Ubicacion</option>
								<option value="8">Fecha + hora</option>
							</select>
						</div>
						<button type="button" onclick="crgraph();" class="btn btn-secondary">Realizar grafica</button>

					</div>
				</div>

				<canvas id="lqsea"></canvas>
			</div>
		</div>
	</div>
	<!-- Start your project here-->

	<!-- SCRIPTS -->
	<!-- JQuery -->
	<script type="text/javascript" src="js/jquery-3.4.1.min.js"></script>
	<!-- Bootstrap tooltips -->
	<script type="text/javascript" src="js/popper.min.js"></script>
	<!-- Bootstrap core JavaScript -->
	<script type="text/javascript" src="js/bootstrap.min.js"></script>
	<!-- MDB core JavaScript -->
	<script type="text/javascript" src="js/mdb.min.js"></script>

	<script>
		function getSearchParameters() {
			var prmstr = window.location.search.substr(1);
			return prmstr != null && prmstr != "" ? transformToAssocArray(prmstr) : {};
		}

		function transformToAssocArray(prmstr) {
			var params = {};
			var prmarr = prmstr.split("?");
			for (var i = 0; i < prmarr.length; i++) {
				var tmparr = prmarr[i].split("=");
				params[tmparr[0]] = tmparr[1];
			}
			return params;
		}

		var param = getSearchParameters();




		var fechas = [];
		var ubicaciones = [];


		var arrTitle = []; //fecha  + hora
		var arrDataPeso = [];
		var arrDataTemp = [];
		var arrDataCA = [];
		var arrDataHL = [];

		var arrFecha = [];
		var arrHora = [];
		var arrUbic = [];


		function crgraph() {

			var s1 = parseInt(document.getElementById("gs1").value);
			var s2 = parseInt(document.getElementById("gs2").value);

			var titulo = "";
			var de = "";
			var segun = "";

			var arr1 = [];
			var arr2 = [];
			switch (s1) {
				case 1: arr1 = arrDataPeso; de = "Peso"; break;
				case 2: arr1 = arrDataTemp; de = "Temperatura"; break;
				case 3: arr1 = arrDataCA; de = "Calidad del aire"; break;
				case 4: arr1 = arrDataHL; de = "Porcentaje de liquido"; break;
				case 5: arr1 = arrFecha; de = "Fecha"; break;
				case 6: arr1 = arrHora; de = "Hora"; break;
				case 7: arr1 = arrUbic; de = "Ubicacion"; break;
				case 8: arr1 = arrTitle; de = "Fecha + hora"; break;

			}

			switch (s2) {
				case 1: arr2 = arrDataPeso; segun = "Peso"; break;
				case 2: arr2 = arrDataTemp; segun = "Temperatura"; break;
				case 3: arr2 = arrDataCA; segun = "Calidad del aire"; break;
				case 4: arr2 = arrDataHL; segun = "Porcentaje de liquido"; break;
				case 5: arr2 = arrFecha; segun = "Fecha"; break;
				case 6: arr2 = arrHora; segun = "Hora"; break;
				case 7: arr2 = arrUbic; segun = "Ubicacion"; break;
				case 8: arr2 = arrTitle; segun = "Fecha + hora"; break;
			}



			var lqsea = document.getElementById("lqsea").getContext('2d');
			new Chart(lqsea, {
				type: 'line',
				data: {
					labels: arr2,
					datasets: [{
						label: "Grafica de " + de + " en funcion de " + segun,
						data: arr1,
						backgroundColor: [
							'rgba(255, 100, 25, .2)',
						],
						borderColor: [
							'rgba(255, 100, 25, .7)',
						],
						borderWidth: 2
					}]
				}, options: { responsive: true }
			});

		}

		function insertGraph(n) {
			var url = './api/Estados';
			$.getJSON(url, function (data) {
				//$.getJSON('./api/Estados?filter[order]=id%20DESC&filter[limit]=100', function(data) {
				//	alert(data.length);

				var sf = "";
				var su = "";
				var hi = "";
				var hf = "";

				if (n == 0) {
					//sin filtros
					document.getElementById("filtro").innerHTML = "Sin filtros";
				} else if (n == 1) {
					sf = (document.getElementById("sfecha").value);


					document.getElementById("filtro").innerHTML = "Filtro por hora " + sf;
				} else if (n == 2) {
					su = (document.getElementById("su").value);
					document.getElementById("filtro").innerHTML = "Filtro por ubicacion " + su;
				} else if (n == 3) {
					hi = parseFloat(document.getElementById("sh1").value);
					hf = parseFloat(document.getElementById("sh2").value);

					document.getElementById("filtro").innerHTML = "Filtro por rango de horas " + hi + "-" + hf;
				}

				arrTitle = []; //fecha  + hora
				arrDataPeso = [];
				arrDataTemp = [];
				arrDataCA = [];
				arrDataHL = [];

				arrFecha = [];
				arrHora = [];
				arrUbic = [];


				for (var a = 0; a < data.length; a++) {
					var st = data[a].fecha + " " + data[a].hora;

					if (data[a].posicion == null || data[a].posicion == "") {
						continue;
					}

					if (data[a].posicion.split(",").length != 2) {
						continue;
					}

					if (n == 0) {
						if (fechas.indexOf(data[a].fecha) == -1) {
							fechas.push(data[a].fecha);
						}
						if (ubicaciones.indexOf(data[a].posicion) == -1) {
							ubicaciones.push(data[a].posicion);
						}
					} else if (n == 1) {
						if (sf != data[a].fecha) {
							continue;
						}
					} else if (n == 2) {
						if (su != data[a].posicion) {
							continue;
						}
					} else if (n == 3) {
						var aux = data[a].hora;
						var aux2 = parseFloat(aux.split(":")[0]);

						if (!(hi <= aux2 && aux2 <= hf)) {
							continue;
						}

					}




					data[a].temperatura = data[a].temperatura == null ? 0 : data[a].temperatura;
					data[a].peso = data[a].peso == null ? 0 : data[a].peso;
					data[a].calidadaire = data[a].calidadaire == null ? 0 : data[a].peso;
					if (data[a].peso < 0) {
						data[a].peso *= -1;
					}
					if (data[a].calidadaire <= 0) {
						data[a].calidadaire = 0;
					}


					arrTitle.push(st);
					arrDataPeso.push(parseFloat(data[a].peso));
					arrDataTemp.push(parseFloat(data[a].temperatura));
					arrDataCA.push(parseFloat(data[a].calidadaire));
					arrDataHL.push(parseFloat(data[a].hayagua));

					arrFecha.push(data[a].fecha);
					arrHora.push(data[a].hora);
					arrUbic.push(data[a].posicion);

				}


				var lpeso = document.getElementById("lcPeso").getContext('2d');
				var lcTemp = document.getElementById("lcTemp").getContext('2d');
				var lcTodo = document.getElementById("lcTodo").getContext('2d');
				var lcCa = document.getElementById("lcCa").getContext('2d');
				var lcHl = document.getElementById("lcHl").getContext('2d');
				new Chart(lcHl, {
					type: 'line',
					data: {
						labels: arrTitle,
						datasets: [{
							label: "Grafica de Liquidos",
							data: arrDataHL,
							backgroundColor: [
								'rgba(255, 100, 25, .2)',
							],
							borderColor: [
								'rgba(255, 100, 25, .7)',
							],
							borderWidth: 2
						}]
					}, options: { responsive: true }
				});
				new Chart(lpeso, {
					type: 'line',
					data: {
						labels: arrTitle,
						datasets: [{
							label: "Grafica de Peso",
							data: arrDataPeso,
							backgroundColor: [
								'rgba(25, 255, 25, .2)',
							],
							borderColor: [
								'rgba(25, 255, 25, .7)',
							],
							borderWidth: 2
						}]
					}, options: { responsive: true }
				});

				new Chart(lcCa, {
					type: 'line',
					data: {
						labels: arrTitle,
						datasets: [{
							label: "Grafica de Calidad de aire",
							data: arrDataCA,
							backgroundColor: [
								'rgba(50, 100, 150, .2)',
							],
							borderColor: [
								'rgba(50, 100, 150, .7)',
							],
							borderWidth: 2
						}]
					}, options: { responsive: true }
				});


				new Chart(lcTemp, {
					type: 'line',
					data: {
						labels: arrTitle,
						datasets: [{
							label: "Grafica de Temperatura",
							data: arrDataTemp,
							backgroundColor: [
								'rgba(105, 0, 132, .2)',
							],
							borderColor: [
								'rgba(200, 99, 132, .7)',
							],
							borderWidth: 2
						}]
					}, options: { responsive: true }
				});
				new Chart(lcTodo, {
					type: 'line',
					data: {
						labels: arrTitle,
						datasets: [{
							label: "Grafica de Liquidos",
							data: arrDataHL,
							backgroundColor: [
								'rgba(255, 100, 25, .2)',
							],
							borderColor: [
								'rgba(255, 100, 25, .7)',
							],
							borderWidth: 2
						}, {
							label: "Grafica de Calidad de aire",
							data: arrDataCA,
							backgroundColor: [
								'rgba(50, 100, 150, .2)',
							],
							borderColor: [
								'rgba(50, 100, 150, .7)',
							],
							borderWidth: 2
						}, {
							label: "Grafica de Peso",
							data: arrDataPeso,
							backgroundColor: [
								'rgba(25, 255, 25, .2)',
							],
							borderColor: [
								'rgba(25, 255, 25, .7)',
							],
							borderWidth: 2
						}, {
							label: "Grafica de Temperatura",
							data: arrDataTemp,
							backgroundColor: [
								'rgba(105, 0, 132, .2)',
							],
							borderColor: [
								'rgba(200, 99, 132, .7)',
							],
							borderWidth: 2
						}]
					}, options: { responsive: true }
				});


				var optionsFecha = "";
				for (var a = 0; a < fechas.length; a++) {
					optionsFecha += "<option>" + fechas[a] + "</option>";

				}

				var optionUbic = "";
				for (var a = 0; a < ubicaciones.length; a++) {
					optionUbic += "<option>" + ubicaciones[a] + "</option>";
				}

				document.getElementById("fFecha").innerHTML = "<div class=\"form-group\">" +
					"<label for=\"exampleFormControlSelect1\">Filtrar por fecha</label>" +
					"<select class=\"form-control\" id=\"sfecha\">" +
					optionsFecha +
					"</select>" +
					"</div>" +
					"";


				document.getElementById("fUbic").innerHTML = "<div class=\"form-group\">" +
					"<label for=\"exampleFormControlSelect1\">Filtrar por Ubicacion</label>" +
					"<select class=\"form-control\" id=\"su\">" +
					optionUbic +
					"</select>" +
					"</div>" +
					"";

				var optionHora = "";

				for (var a = 0; a < 25; a++) {

					optionHora += "<option>" + (a) + "</option>";
				}

				document.getElementById("fHora").innerHTML = "<div class=\"form-group\">" +
					"<label for=\"exampleFormControlSelect1\">Filtrar por hora</label><br/>Inicio" +
					"<select class=\"form-control\" id=\"sh1\">" +
					optionHora +
					"</select><br/>FIn" +
					"<select class=\"form-control\" id=\"sh2\">" +
					optionHora +
					"</select>" +
					"</div>" +
					"";

			});





		}

		insertGraph(0);
	</script>

</body>

</html>